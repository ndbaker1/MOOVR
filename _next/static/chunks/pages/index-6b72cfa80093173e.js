(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3454:function(t,e,n){"use strict";var r,o;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"===typeof(null==(o=n.g.process)?void 0:o.env)?n.g.process:n(7663)},8312:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(367)}])},367:function(t,e,n){"use strict";function r(t,e,n,r,o,s,i){try{var a=t[s](i),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,s){var i=t.apply(e,n);function a(t){r(i,o,s,a,c,"next",t)}function c(t){r(i,o,s,a,c,"throw",t)}a(void 0)}))}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.r(e),n.d(e,{default:function(){return z}});var a=n(4051),c=n.n(a),l=n(5893),u=(n(7294),n(9477));const h=/^[og]\s*(.+)?/,f=/^mtllib /,p=/^usemtl /,d=/^usemap /,m=/\s+/,v=new u.Pa4,g=new u.Pa4,b=new u.Pa4,y=new u.Pa4,w=new u.Pa4,x=new u.Ilk;function j(){const t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);const n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){const e={index:"number"===typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){const e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"===typeof n.clone){const t=n.clone(0);t.inherited=!0,this.object.materials.push(t)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){const n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[t+0],r[t+1],r[t+2]),o.push(r[e+0],r[e+1],r[e+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){const r=this.normals,o=this.object.geometry.normals;o.push(r[t+0],r[t+1],r[t+2]),o.push(r[e+0],r[e+1],r[e+2]),o.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(t,e,n){const r=this.vertices,o=this.object.geometry.normals;v.fromArray(r,t),g.fromArray(r,e),b.fromArray(r,n),w.subVectors(b,g),y.subVectors(v,g),w.cross(y),w.normalize(),o.push(w.x,w.y,w.z),o.push(w.x,w.y,w.z),o.push(w.x,w.y,w.z)},addColor:function(t,e,n){const r=this.colors,o=this.object.geometry.colors;void 0!==r[t]&&o.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&o.push(r[e+0],r[e+1],r[e+2]),void 0!==r[n]&&o.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[t+0],r[t+1]),o.push(r[e+0],r[e+1]),o.push(r[n+0],r[n+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,o,s,i,a,c){const l=this.vertices.length;let u=this.parseVertexIndex(t,l),h=this.parseVertexIndex(e,l),f=this.parseVertexIndex(n,l);if(this.addVertex(u,h,f),this.addColor(u,h,f),void 0!==i&&""!==i){const t=this.normals.length;u=this.parseNormalIndex(i,t),h=this.parseNormalIndex(a,t),f=this.parseNormalIndex(c,t),this.addNormal(u,h,f)}else this.addFaceNormal(u,h,f);if(void 0!==r&&""!==r){const t=this.uvs.length;u=this.parseUVIndex(r,t),h=this.parseUVIndex(o,t),f=this.parseUVIndex(s,t),this.addUV(u,h,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let n=0,r=t.length;n<r;n++){const r=this.parseVertexIndex(t[n],e);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let o=0,s=t.length;o<s;o++)this.addVertexLine(this.parseVertexIndex(t[o],n));for(let o=0,s=e.length;o<s;o++)this.addUVLine(this.parseUVIndex(e[o],r))}};return t.startObject("",!1),t}class E extends u.aNw{constructor(t){super(t),this.materials=null}load(t,e,n,r){const o=this,s=new u.hH6(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(o.parse(n))}catch(s){r?r(s):console.error(s),o.manager.itemError(t)}}),n,r)}setMaterials(t){return this.materials=t,this}parse(t){const e=new j;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const n=t.split("\n");let r=[];for(let s=0,i=n.length;s<i;s++){const t=n[s].trimStart();if(0===t.length)continue;const o=t.charAt(0);if("#"!==o)if("v"===o){const n=t.split(m);switch(n[0]){case"v":e.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(x.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])).convertSRGBToLinear(),e.colors.push(x.r,x.g,x.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":e.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}}else if("f"===o){const n=t.slice(1).trim().split(m),r=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];if(e.length>0){const t=e.split("/");r.push(t)}}const o=r[0];for(let t=1,s=r.length-1;t<s;t++){const n=r[t],s=r[t+1];e.addFace(o[0],n[0],s[0],o[1],n[1],s[1],o[2],n[2],s[2])}}else if("l"===o){const n=t.substring(1).trim().split(" ");let r=[];const o=[];if(-1===t.indexOf("/"))r=n;else for(let t=0,e=n.length;t<e;t++){const e=n[t].split("/");""!==e[0]&&r.push(e[0]),""!==e[1]&&o.push(e[1])}e.addLineGeometry(r,o)}else if("p"===o){const n=t.slice(1).trim().split(" ");e.addPointGeometry(n)}else if(null!==(r=h.exec(t))){const t=(" "+r[0].slice(1).trim()).slice(1);e.startObject(t)}else if(p.test(t))e.object.startMaterial(t.substring(7).trim(),e.materialLibraries);else if(f.test(t))e.materialLibraries.push(t.substring(7).trim());else if(d.test(t))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===o){if(r=t.split(" "),r.length>1){const t=r[1].trim().toLowerCase();e.object.smooth="0"!==t&&"off"!==t}else e.object.smooth=!0;const n=e.object.currentMaterial();n&&(n.smooth=e.object.smooth)}else{if("\0"===t)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+t+'"')}}e.finalize();const o=new u.ZAu;o.materialLibraries=[].concat(e.materialLibraries);if(!0===!(1===e.objects.length&&0===e.objects[0].geometry.vertices.length))for(let s=0,i=e.objects.length;s<i;s++){const t=e.objects[s],n=t.geometry,r=t.materials,i="Line"===n.type,a="Points"===n.type;let c=!1;if(0===n.vertices.length)continue;const l=new u.u9r;l.setAttribute("position",new u.a$l(n.vertices,3)),n.normals.length>0&&l.setAttribute("normal",new u.a$l(n.normals,3)),n.colors.length>0&&(c=!0,l.setAttribute("color",new u.a$l(n.colors,3))),!0===n.hasUVIndices&&l.setAttribute("uv",new u.a$l(n.uvs,2));const h=[];for(let o=0,s=r.length;o<s;o++){const t=r[o],n=t.name+"_"+t.smooth+"_"+c;let s=e.materials[n];if(null!==this.materials)if(s=this.materials.create(t.name),!i||!s||s instanceof u.nls){if(a&&s&&!(s instanceof u.UY4)){const t=new u.UY4({size:10,sizeAttenuation:!1});u.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,s=t}}else{const t=new u.nls;u.F5T.prototype.copy.call(t,s),t.color.copy(s.color),s=t}void 0===s&&(s=i?new u.nls:a?new u.UY4({size:1,sizeAttenuation:!1}):new u.xoR,s.name=t.name,s.flatShading=!t.smooth,s.vertexColors=c,e.materials[n]=s),h.push(s)}let f;if(h.length>1){for(let t=0,e=r.length;t<e;t++){const e=r[t];l.addGroup(e.groupStart,e.groupCount,t)}f=i?new u.ejS(l,h):a?new u.woe(l,h):new u.Kj0(l,h)}else f=i?new u.ejS(l,h[0]):a?new u.woe(l,h[0]):new u.Kj0(l,h[0]);f.name=t.name,o.add(f)}else if(e.vertices.length>0){const t=new u.UY4({size:1,sizeAttenuation:!1}),n=new u.u9r;n.setAttribute("position",new u.a$l(e.vertices,3)),e.colors.length>0&&void 0!==e.colors[0]&&(n.setAttribute("color",new u.a$l(e.colors,3)),t.vertexColors=!0);const r=new u.woe(n,t);o.add(r)}return o}}var L,A,S=null!==(L=n(3454).env.NEXT_PUBLIC_WS_SERVER)&&void 0!==L?L:"localhost:42069",V=null!==(A="/phone-pong")?A:"";function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t){var e,n=location.protocol.includes("https")?"wss":"ws",r=null!==(e=sessionStorage.getItem("WS_SERVER"))&&void 0!==e?e:S,o="".concat(n,"://").concat(r).concat(t);if(!o.startsWith("ws"))throw Error("bad url");var s=new WebSocket(o);return s.addEventListener("close",(function(t){return console.log(JSON.stringify(t))})),s.addEventListener("error",(function(t){return console.error(JSON.stringify(t))})),s.addEventListener("open",(function(t){return console.log(JSON.stringify(t))})),s}var k=function(){function t(e){T(this,t),this.ws=I("/observer/".concat(e))}return t.asPlayerData=function(t){if("string"===typeof t)return JSON.parse(t);throw Error("invalid data")},t}();function C(){return(C=o(c().mark((function t(e){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"}),t.next=3,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 3:return r=t.sent,n.addEventListener("reading",(function(){e({type:"Rotation",data:n.quaternion})})),n.addEventListener("error",console.log),r.every((function(t){return"granted"===t.state}))?n.start():console.log("No permissions to use AbsoluteOrientationSensor."),t.abrupt("return",(function(){return n.stop()}));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return(_=o(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new LinearAccelerationSensor({frequency:60})).addEventListener("reading",(function(){e({type:"Acceleration",data:[n.x,n.y,n.z]})})),n.addEventListener("error",console.log),n.start(),t.abrupt("return",(function(){return n.stop()}));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var P=function t(e){var n=this;T(this,t),this.ws=I("/racket/".concat(e));var r=function(t){n.ws.send(JSON.stringify(t))};!function(t){_.apply(this,arguments)}(r),function(t){C.apply(this,arguments)}(r)},z=function(){return(0,l.jsxs)("div",{id:"app",children:[(0,l.jsxs)("div",{style:{position:"absolute"},children:[(0,l.jsx)("button",{onClick:function(){return function(t,e){return U.apply(this,arguments)}({},new k(0))},children:"observer"}),(0,l.jsx)("button",{onClick:function(){return new P(0)},children:"racket 0"}),(0,l.jsx)("button",{onClick:function(){return new P(1)},children:"racket 1"})]}),(0,l.jsx)("main",{id:"screen"})]})};function N(){return O.apply(this,arguments)}function O(){return(O=o(c().mark((function t(){var e,n,r,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new E,t.next=3,e.loadAsync("".concat(V,"/assets/phone-pong.obj"));case 3:return n=t.sent,(r=n.children[1]).material=new u.RSm,o=n.children[0],t.abrupt("return",{racketMesh:r,ballMesh:o});case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function U(){return(U=o(c().mark((function t(e,n){var r,o,s,a,l,h,f,p;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p=function(t){h.render(r,o)},r=new u.xsS,(o=new u.cPb(80,window.innerWidth/window.innerHeight,.1,1e4)).position.set(-500,0,0),o.lookAt(0,0,0),t.next=7,N();case 7:if(s=t.sent,s.ballMesh,a=s.racketMesh,l=new Map,(h=new u.CP7({antialias:!0})).setSize(window.innerWidth,window.innerHeight),h.setAnimationLoop(p),!(f=document.querySelector('main[id="screen"]'))){t.next=19;break}f.replaceChildren(h.domElement),t.next=20;break;case 19:throw Error("failed to replace screen with renderer.");case 20:n.ws.addEventListener("message",(function(t){var e=t.data,n=k.asPlayerData(e);Object.entries(n).forEach((function(t){var e=i(t,2),n=e[0],o=e[1];if(!l.has(n)){var s=a.clone();l.set(n,s),r.add(s)}var c=l.get(n),u=i(o.rotation,4),h=u[0],f=u[1],p=u[2],d=u[3],m=c.quaternion.fromArray([h,p,f,d]).invert();m.z*=-1,m.w*=-1;var v=i(o.position.map((function(t){return 2e3*t})),3);v[0],v[1],v[2]}))}));case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},7663:function(t){!function(){var e={308:function(t){var e,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function i(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"===typeof setTimeout?setTimeout:o}catch(t){e=o}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var a,c=[],l=!1,u=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&f())}function f(){if(!l){var t=i(h);l=!0;for(var e=c.length;e;){for(a=c,c=[];++u<e;)a&&a[u].run();u=-1,e=c.length}a=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function d(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new p(t,e)),1!==c.length||l||i(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var s=n[t]={exports:{}},i=!0;try{e[t](s,s.exports,r),i=!1}finally{i&&delete n[t]}return s.exports}r.ab="//";var o=r(308);t.exports=o}()}},function(t){t.O(0,[737,774,888,179],(function(){return e=8312,t(t.s=e);var e}));var e=t.O();_N_E=e}]);