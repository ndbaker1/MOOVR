(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(712)}])},712:function(t,e,n){"use strict";function r(t,e,n,r,s,o,i){try{var a=t[o](i),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,s)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(s,o){var i=t.apply(e,n);function a(t){r(i,s,o,a,c,"next",t)}function c(t){r(i,s,o,a,c,"throw",t)}a(void 0)}))}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.r(e),n.d(e,{default:function(){return C}});var a=n(4051),c=n.n(a),l=n(5893),u=(n(7294),n(9477));const h=/^[og]\s*(.+)?/,p=/^mtllib /,d=/^usemtl /,f=/^usemap /,m=/\s+/,g=new u.Pa4,v=new u.Pa4,b=new u.Pa4,w=new u.Pa4,y=new u.Pa4,x=new u.Ilk;function j(){const t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);const n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){const e={index:"number"===typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){const e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"===typeof n.clone){const t=n.clone(0);t.inherited=!0,this.object.materials.push(t)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){const n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){const n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){const r=this.vertices,s=this.object.geometry.vertices;s.push(r[t+0],r[t+1],r[t+2]),s.push(r[e+0],r[e+1],r[e+2]),s.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){const r=this.normals,s=this.object.geometry.normals;s.push(r[t+0],r[t+1],r[t+2]),s.push(r[e+0],r[e+1],r[e+2]),s.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(t,e,n){const r=this.vertices,s=this.object.geometry.normals;g.fromArray(r,t),v.fromArray(r,e),b.fromArray(r,n),y.subVectors(b,v),w.subVectors(g,v),y.cross(w),y.normalize(),s.push(y.x,y.y,y.z),s.push(y.x,y.y,y.z),s.push(y.x,y.y,y.z)},addColor:function(t,e,n){const r=this.colors,s=this.object.geometry.colors;void 0!==r[t]&&s.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&s.push(r[e+0],r[e+1],r[e+2]),void 0!==r[n]&&s.push(r[n+0],r[n+1],r[n+2])},addUV:function(t,e,n){const r=this.uvs,s=this.object.geometry.uvs;s.push(r[t+0],r[t+1]),s.push(r[e+0],r[e+1]),s.push(r[n+0],r[n+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,r,s,o,i,a,c){const l=this.vertices.length;let u=this.parseVertexIndex(t,l),h=this.parseVertexIndex(e,l),p=this.parseVertexIndex(n,l);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==i&&""!==i){const t=this.normals.length;u=this.parseNormalIndex(i,t),h=this.parseNormalIndex(a,t),p=this.parseNormalIndex(c,t),this.addNormal(u,h,p)}else this.addFaceNormal(u,h,p);if(void 0!==r&&""!==r){const t=this.uvs.length;u=this.parseUVIndex(r,t),h=this.parseUVIndex(s,t),p=this.parseUVIndex(o,t),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let n=0,r=t.length;n<r;n++){const r=this.parseVertexIndex(t[n],e);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let s=0,o=t.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(t[s],n));for(let s=0,o=e.length;s<o;s++)this.addUVLine(this.parseUVIndex(e[s],r))}};return t.startObject("",!1),t}class A extends u.aNw{constructor(t){super(t),this.materials=null}load(t,e,n,r){const s=this,o=new u.hH6(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(s.parse(n))}catch(o){r?r(o):console.error(o),s.manager.itemError(t)}}),n,r)}setMaterials(t){return this.materials=t,this}parse(t){const e=new j;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const n=t.split("\n");let r=[];for(let o=0,i=n.length;o<i;o++){const t=n[o].trimStart();if(0===t.length)continue;const s=t.charAt(0);if("#"!==s)if("v"===s){const n=t.split(m);switch(n[0]){case"v":e.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])),n.length>=7?(x.setRGB(parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])).convertSRGBToLinear(),e.colors.push(x.r,x.g,x.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));break;case"vt":e.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}}else if("f"===s){const n=t.slice(1).trim().split(m),r=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];if(e.length>0){const t=e.split("/");r.push(t)}}const s=r[0];for(let t=1,o=r.length-1;t<o;t++){const n=r[t],o=r[t+1];e.addFace(s[0],n[0],o[0],s[1],n[1],o[1],s[2],n[2],o[2])}}else if("l"===s){const n=t.substring(1).trim().split(" ");let r=[];const s=[];if(-1===t.indexOf("/"))r=n;else for(let t=0,e=n.length;t<e;t++){const e=n[t].split("/");""!==e[0]&&r.push(e[0]),""!==e[1]&&s.push(e[1])}e.addLineGeometry(r,s)}else if("p"===s){const n=t.slice(1).trim().split(" ");e.addPointGeometry(n)}else if(null!==(r=h.exec(t))){const t=(" "+r[0].slice(1).trim()).slice(1);e.startObject(t)}else if(d.test(t))e.object.startMaterial(t.substring(7).trim(),e.materialLibraries);else if(p.test(t))e.materialLibraries.push(t.substring(7).trim());else if(f.test(t))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===s){if(r=t.split(" "),r.length>1){const t=r[1].trim().toLowerCase();e.object.smooth="0"!==t&&"off"!==t}else e.object.smooth=!0;const n=e.object.currentMaterial();n&&(n.smooth=e.object.smooth)}else{if("\0"===t)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+t+'"')}}e.finalize();const s=new u.ZAu;s.materialLibraries=[].concat(e.materialLibraries);if(!0===!(1===e.objects.length&&0===e.objects[0].geometry.vertices.length))for(let o=0,i=e.objects.length;o<i;o++){const t=e.objects[o],n=t.geometry,r=t.materials,i="Line"===n.type,a="Points"===n.type;let c=!1;if(0===n.vertices.length)continue;const l=new u.u9r;l.setAttribute("position",new u.a$l(n.vertices,3)),n.normals.length>0&&l.setAttribute("normal",new u.a$l(n.normals,3)),n.colors.length>0&&(c=!0,l.setAttribute("color",new u.a$l(n.colors,3))),!0===n.hasUVIndices&&l.setAttribute("uv",new u.a$l(n.uvs,2));const h=[];for(let s=0,o=r.length;s<o;s++){const t=r[s],n=t.name+"_"+t.smooth+"_"+c;let o=e.materials[n];if(null!==this.materials)if(o=this.materials.create(t.name),!i||!o||o instanceof u.nls){if(a&&o&&!(o instanceof u.UY4)){const t=new u.UY4({size:10,sizeAttenuation:!1});u.F5T.prototype.copy.call(t,o),t.color.copy(o.color),t.map=o.map,o=t}}else{const t=new u.nls;u.F5T.prototype.copy.call(t,o),t.color.copy(o.color),o=t}void 0===o&&(o=i?new u.nls:a?new u.UY4({size:1,sizeAttenuation:!1}):new u.xoR,o.name=t.name,o.flatShading=!t.smooth,o.vertexColors=c,e.materials[n]=o),h.push(o)}let p;if(h.length>1){for(let t=0,e=r.length;t<e;t++){const e=r[t];l.addGroup(e.groupStart,e.groupCount,t)}p=i?new u.ejS(l,h):a?new u.woe(l,h):new u.Kj0(l,h)}else p=i?new u.ejS(l,h[0]):a?new u.woe(l,h[0]):new u.Kj0(l,h[0]);p.name=t.name,s.add(p)}else if(e.vertices.length>0){const t=new u.UY4({size:1,sizeAttenuation:!1}),n=new u.u9r;n.setAttribute("position",new u.a$l(e.vertices,3)),e.colors.length>0&&void 0!==e.colors[0]&&(n.setAttribute("color",new u.a$l(e.colors,3)),t.vertexColors=!0);const r=new u.woe(n,t);s.add(r)}return s}}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t){var e=location.protocol.includes("https")?"wss":"ws",n="".concat(e,"://").concat("phone-pong-production.up.railway.app").concat(t);if(!n.startsWith("ws"))throw Error("bad url");var r=new WebSocket(n);return r.addEventListener("close",(function(t){return console.log(JSON.stringify(t))})),r.addEventListener("error",(function(t){return console.error(JSON.stringify(t))})),r.addEventListener("open",(function(t){return console.log(JSON.stringify(t))})),r}var V=function(){function t(e){E(this,t),this.ws=L("/observer/".concat(e))}return t.asPlayerData=function(t){if("string"===typeof t)return JSON.parse(t);throw Error("invalid data")},t}();function S(){return(S=s(c().mark((function t(e){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"}),t.next=3,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 3:return r=t.sent,n.addEventListener("reading",(function(){e({type:"Rotation",data:n.quaternion})})),n.addEventListener("error",console.log),r.every((function(t){return"granted"===t.state}))?n.start():console.log("No permissions to use AbsoluteOrientationSensor."),t.abrupt("return",(function(){return n.stop()}));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(){return(I=s(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new LinearAccelerationSensor({frequency:60})).addEventListener("reading",(function(){e({type:"Acceleration",data:[n.x,n.y,n.z]})})),n.addEventListener("error",console.log),n.start(),t.abrupt("return",(function(){return n.stop()}));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var k=function t(e){var n=this;E(this,t),this.ws=L("/racket/".concat(e));var r=function(t){n.ws.send(JSON.stringify(t))};!function(t){I.apply(this,arguments)}(r),function(t){S.apply(this,arguments)}(r)},C=function(){return(0,l.jsxs)("div",{id:"app",children:[(0,l.jsxs)("div",{style:{position:"absolute"},children:[(0,l.jsx)("button",{onClick:function(){return function(t,e){return N.apply(this,arguments)}({},new V(0))},children:"observer"}),(0,l.jsx)("button",{onClick:function(){return new k(0)},children:"racket 0"}),(0,l.jsx)("button",{onClick:function(){return new k(1)},children:"racket 1"})]}),(0,l.jsx)("main",{id:"screen"})]})};function z(){return P.apply(this,arguments)}function P(){return(P=s(c().mark((function t(){var e,n,r,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new A,t.next=3,e.loadAsync("../assets/phone-pong.obj");case 3:return n=t.sent,(r=n.children[1]).material=new u.RSm,s=n.children[0],t.abrupt("return",{racketMesh:r,ballMesh:s});case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function N(){return(N=s(c().mark((function t(e,n){var r,s,o,a,l,h,p,d;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=function(t){h.render(r,s)},r=new u.xsS,(s=new u.cPb(80,window.innerWidth/window.innerHeight,.1,1e4)).position.set(-500,0,0),s.lookAt(0,0,0),t.next=7,z();case 7:if(o=t.sent,o.ballMesh,a=o.racketMesh,l=new Map,(h=new u.CP7({antialias:!0})).setSize(window.innerWidth,window.innerHeight),h.setAnimationLoop(d),!(p=document.querySelector('main[id="screen"]'))){t.next=19;break}p.replaceChildren(h.domElement),t.next=20;break;case 19:throw Error("failed to replace screen with renderer.");case 20:n.ws.addEventListener("message",(function(t){var e=t.data,n=V.asPlayerData(e);Object.entries(n).forEach((function(t){var e=i(t,2),n=e[0],s=e[1];if(!l.has(n)){var o=a.clone();l.set(n,o),r.add(o)}var c=l.get(n),u=i(s.rotation,4),h=u[0],p=u[1],d=u[2],f=u[3],m=c.quaternion.fromArray([h,d,p,f]).invert();m.z*=-1,m.w*=-1;var g=i(s.position.map((function(t){return 2e3*t})),3);g[0],g[1],g[2]}))}));case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}},function(t){t.O(0,[737,774,888,179],(function(){return e=8312,t(t.s=e);var e}));var e=t.O();_N_E=e}]);