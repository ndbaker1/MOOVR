(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(1726)}])},1726:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return q}});var t,o,s=r(7568),i=r(828),a=r(9815),c=r(4051),u=r.n(c),l=r(5893),d=r(517),h=r(7564),p=r(6137),f=r(4293),w=r(7841),v=r(9814),x=r(9834),y=r(5477),g=r(8393),m=r(7294),j=r(8254),k=r(7707),S=r(9477),b=r(7011),E=null!==(t="phone-pong-production.up.railway.app")?t:"localhost:42069",Z=null!==(o="/phone-pong")?o:"",A=r(1438);function C(e){var n=e.path,r=e.host,t=location.protocol.includes("https")?"wss":"ws",o="".concat(t,"://").concat(r).concat(n);if(!o.startsWith("ws"))throw Error("bad url");var s=new WebSocket(o);return s.addEventListener("close",(function(e){return console.log(JSON.stringify(e))})),s.addEventListener("error",(function(e){return console.error(JSON.stringify(e))})),s.addEventListener("open",(function(e){return console.log(JSON.stringify(e))})),s}var O=function(){function e(n,r){(0,A.Z)(this,e),this.ws=C({host:r,path:"/observer/".concat(n)})}return e.asPlayerData=function(e){if("string"===typeof e)return JSON.parse(e);throw Error("invalid data")},e}();function L(){return(L=(0,s.Z)(u().mark((function e(n){var r,t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"}),e.next=3,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 3:return t=e.sent,r.addEventListener("reading",(function(){try{n({type:"Rotation",data:r.quaternion})}catch(e){console.error(e),r.stop()}})),r.addEventListener("error",console.log),t.every((function(e){return"granted"===e.state}))?r.start():console.log("No permissions to use AbsoluteOrientationSensor."),e.abrupt("return",(function(){return r.stop()}));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=(0,s.Z)(u().mark((function e(n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new LinearAccelerationSensor({frequency:60})).addEventListener("reading",(function(){try{n({type:"Acceleration",data:[r.x,r.y,r.z]})}catch(e){console.error(e),r.stop()}})),r.addEventListener("error",console.log),r.start(),e.abrupt("return",(function(){return r.stop()}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function e(n,r){var t=this;(0,A.Z)(this,e),this.ws=C({host:r,path:"/racket/".concat(n)});var o=function(e){if(t.ws.readyState===t.ws.CLOSING||t.ws.readyState===t.ws.CLOSED)throw Error("connection closed");t.ws.readyState===t.ws.OPEN&&t.ws.send(JSON.stringify(e))};!function(e){N.apply(this,arguments)}(o),function(e){L.apply(this,arguments)}(o)};var q=function(){var e=(0,i.Z)(m.useState(!0),2),n=e[0],r=e[1],t=function(e){var n=(0,i.Z)(m.useState(""),2),r=n[0],t=n[1],o=(r||e).replaceAll(/.*:\/\/|\/$/gi,"");return{host:r,setHost:t,webSocketHost:o}}(E),o=t.host,s=t.setHost,c=t.webSocketHost;return(0,l.jsxs)("div",{id:"app",children:[(0,l.jsx)(d.V,{opened:n,withCloseButton:!0,onClose:function(){return r(!1)},size:"min(90vw, 30rem)",children:(0,l.jsxs)(h.K,{children:[(0,l.jsxs)(p.Z,{grow:!0,children:[(0,l.jsxs)(f.v,{shadow:"md",children:[(0,l.jsx)(f.v.Target,{children:(0,l.jsx)(w.z,{children:"Observer Client"})}),(0,l.jsx)(f.v.Dropdown,{children:(0,l.jsx)(v.M,{cols:3,children:(0,a.Z)(Array(9).keys()).map((function(e){return(0,l.jsx)(p.Z,{grow:!0,children:(0,l.jsx)(x.A,{size:"xl",onClick:function(){return function(e,n){return M.apply(this,arguments)}({},new O(e,c))},children:e})},e)}))})})]}),(0,l.jsxs)(f.v,{shadow:"md",children:[(0,l.jsx)(f.v.Target,{children:(0,l.jsx)(w.z,{children:"Racket Client"})}),(0,l.jsx)(f.v.Dropdown,{children:(0,l.jsx)(v.M,{cols:3,children:(0,a.Z)(Array(9).keys()).map((function(e){return(0,l.jsx)(p.Z,{grow:!0,children:(0,l.jsx)(x.A,{size:"xl",onClick:function(){return new _(e,c)},children:e})},e)}))})})]})]}),(0,l.jsx)(p.Z,{grow:!0,children:(0,l.jsx)(y.o,{icon:(0,l.jsx)(j.Z,{}),rightSection:(0,l.jsx)(g.u,{label:"paste",children:(0,l.jsx)(x.A,{onClick:function(){return navigator.clipboard.readText().then(s)},children:(0,l.jsx)(k.Z,{})})}),placeholder:E,onChange:function(e){return s(e.target.value)},width:"100%",value:o})})]})}),(0,l.jsx)("main",{id:"screen"})]})};function z(){return P.apply(this,arguments)}function P(){return(P=(0,s.Z)(u().mark((function e(){var n,r,t,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new b.L,e.next=3,n.loadAsync("".concat(Z,"/assets/phone-pong.obj"));case 3:return r=e.sent,(t=r.children[1]).material=new S.RSm,o=r.children[0],e.abrupt("return",{racketMesh:t,ballMesh:o});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){return(M=(0,s.Z)(u().mark((function e(n,r){var t,o,s,a,c,l,d,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=function(e){l.render(t,o)},t=new S.xsS,(o=new S.cPb(80,window.innerWidth/window.innerHeight,.1,1e4)).position.set(-500,0,0),o.lookAt(0,0,0),e.next=7,z();case 7:if(s=e.sent,s.ballMesh,a=s.racketMesh,c=new Map,(l=new S.CP7({antialias:!0})).setSize(window.innerWidth,window.innerHeight),l.setAnimationLoop(h),!(d=document.querySelector('main[id="screen"]'))){e.next=19;break}d.replaceChildren(l.domElement),e.next=20;break;case 19:throw Error("failed to replace screen with renderer.");case 20:r.ws.addEventListener("message",(function(e){var n=e.data,r=O.asPlayerData(n);Object.entries(r).forEach((function(e){var n=(0,i.Z)(e,2),r=n[0],o=n[1];if(!c.has(r)){var s=a.clone();c.set(r,s),t.add(s)}var u=c.get(r),l=(0,i.Z)(o.rotation,4),d=l[0],h=l[1],p=l[2],f=l[3],w=u.quaternion.fromArray([d,p,h,f]).invert();w.z*=-1,w.w*=-1;var v=(0,i.Z)(o.position.map((function(e){return 2e3*e})),3);v[0],v[1],v[2]}))}));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}},function(e){e.O(0,[737,702,774,888,179],(function(){return n=8312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);