(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(3552)}])},3552:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return F}});var t=r(7568),o=r(2670),a=r(603),i=r(4051),s=r.n(i),c=r(5893),u=r(7294),l=r(9604),d=r(8254),f=r(7707),h=r(6772),p=r(7564),v=r(7841),w=r(6137),m=r(4078),g=r(966),y=r(9814),x=r(9834),b=r(5477),k=r(8393),S=r(9513),j=r(9477),E=r(7011),Z=r(1438),C=r(8029),L=r(6567),O=r(1799);function A(e){return N.apply(this,arguments)}function N(){return(N=(0,t.Z)(s().mark((function e(n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 2:if(e.sent.every((function(e){return"granted"===e.state}))){e.next=4;break}throw new Error("failed to get permission for orientation sensors");case 4:return(r=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"})).addEventListener("reading",(function(){try{n({type:"Orientation",data:r.quaternion})}catch(e){console.error(e),r.stop()}})),r.addEventListener("error",console.log),r.start(),e.abrupt("return",(function(){return r.stop()}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return q.apply(this,arguments)}function q(){return(q=(0,t.Z)(s().mark((function e(n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 2:if(e.sent.every((function(e){return"granted"===e.state}))){e.next=4;break}throw new Error("failed to get accelerometer");case 4:return(r=new LinearAccelerationSensor({frequency:60})).addEventListener("reading",(function(){try{n({type:"Acceleration",data:[r.x,r.y,r.z]})}catch(e){console.error(e),r.stop()}})),r.addEventListener("error",console.log),r.start(),e.abrupt("return",(function(){return r.stop()}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M,_,z,D,I=function(){function e(n,r,t){var o=r.host,a=r.callbacks,i=this;(0,Z.Z)(this,e),this.id=n,this.send=function(e){i.ws.readyState!==i.ws.CLOSING&&i.ws.readyState!==i.ws.CLOSED||console.error("connection closed"),i.ws.readyState===i.ws.OPEN&&i.ws.send(e)},this.ws=function(e){var n=e.path,r=e.host,t=e.closeCallback,o=e.errorCallback,a=e.openCallback,i=location.protocol.includes("https")?"wss":"ws",s="".concat(i,"://").concat(r).concat(n);if(!s.startsWith("ws"))throw Error("bad url");var c=new WebSocket(s);return c.addEventListener("close",(function(e){return t?t(e):console.log(JSON.stringify(e))})),c.addEventListener("error",(function(e){return o?o(e):console.error(JSON.stringify(e))})),c.addEventListener("open",(function(e){return a?a(e):console.log(JSON.stringify(e))})),c}((0,O.Z)({host:o,path:"/".concat(t,"/").concat(n)},a))}return e.prototype.initSensors=function(){var e=this;return(0,t.Z)(s().mark((function n(){var r,t;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=function(n){return e.send(JSON.stringify(n))},n.next=3,Promise.all([P(r),A(r)]);case 3:t=n.sent,e.ws.addEventListener("error",(function(){return t.forEach((function(e){return e()}))})),e.ws.addEventListener("close",(function(){return t.forEach((function(e){return e()}))}));case 6:case"end":return n.stop()}}),n)})))()},e.asPlayerData=function(e){if("string"===typeof e)return JSON.parse(e);throw Error("invalid data")},e}(),H=function(e){(0,C.Z)(r,e);var n=(0,L.Z)(r);function r(e,t){return(0,Z.Z)(this,r),n.call(this,e,t,"racket")}return r}(I),J=function(e){(0,C.Z)(r,e);var n=(0,L.Z)(r);function r(e,t){return(0,Z.Z)(this,r),n.call(this,e,t,"head")}return r.asPlayerPose=function(e){if("string"===typeof e)return JSON.parse(e);throw Error("invalid data")},r}(I),R=function(e){(0,C.Z)(r,e);var n=(0,L.Z)(r);function r(e,t){return(0,Z.Z)(this,r),n.call(this,e,t,"observer")}return r}(I),W=r(3454),T=null!==(z=null===W||void 0===W||null===(M=W.env)||void 0===M?void 0:"phone-pong-production.up.railway.app")&&void 0!==z?z:"localhost:42069",V=null!==(D=null===W||void 0===W||null===(_=W.env)||void 0===_?void 0:"/MVR")&&void 0!==D?D:"",B=function(){function e(){(0,Z.Z)(this,e)}return e.capture=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(0,t.Z)(s().mark((function r(){var t,o,a,i,c,u,l;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t=document.createElement("canvas"),o=t.getContext("2d"),a=document.createElement("video"),i=150,c=150,r.next=6,navigator.mediaDevices.getUserMedia({audio:!1,video:{frameRate:n,width:{ideal:i},height:{ideal:c},facingMode:{ideal:"environment"}}});case 6:return u=r.sent,a.srcObject=u,a.play(),l=setInterval((function(){o.drawImage(a,0,0),e(o.getImageData(0,0,i,c))}),1e3/n),r.abrupt("return",(function(){clearInterval(l),t.remove(),a.remove()}));case 11:case"end":return r.stop()}}),r)})))()},e}(),F=function(){var e=(0,a.Z)(u.useState(!1),2),n=e[0],r=e[1],t=(0,a.Z)(u.useState(!1),2),o=t[0],i=t[1],s=(0,a.Z)(u.useState(""),2),j=s[0],E=s[1];u.useEffect((function(){window.debug=function(){return r(!0)}}),[]);var Z=(0,a.Z)(u.useState(!0),2),C=Z[0],L=Z[1],O=(0,a.Z)(u.useState(),2),A=O[0],N=O[1],P=(0,a.Z)(u.useState(!1),2),q=P[0],M=P[1],_=(0,a.Z)(u.useState(),2),z=_[0],D=_[1],I=(0,a.Z)(u.useState(!1),2),W=I[0],V=I[1],F=function(e){var n=(0,a.Z)(u.useState(""),2),r=n[0],t=n[1],o=(r||e).replaceAll(/.*:\/\/|\/$/gi,"");return{host:r,setHost:t,webSocketHost:o}}(T),G=F.host,K=F.setHost,X=F.webSocketHost,$=function(e){L(!1),V(!0);var n=function(){var n=new J(e-1,{host:X,callbacks:{}});B.capture((function(e){return n.send(e.data)})),n.initSensors(),function(e,n){U.apply(this,arguments)}({code:j},new R(e,{host:X,callbacks:{}})),D(n),V(!1)};z&&z.ws.readyState!==WebSocket.CLOSED?(z.ws.addEventListener("close",n),z.ws.close()):n()},Q=function(e){L(!1),M(!0);var n=function(){var n=new H(e,{host:X,callbacks:{}});B.capture((function(e){return n.send(e.data)})),n.initSensors(),N(n),M(!1)};A&&A.ws.readyState!==WebSocket.CLOSED?(A.ws.addEventListener("close",n),A.ws.close()):n()};return u.useEffect((function(){var e=new URLSearchParams(location.search),n=e.get("client"),r=parseInt(e.get("id")||"");switch(n){case"racket":Q(r);break;case"observer":$(r)}}),[]),(0,c.jsxs)("div",{id:"app",children:[(0,c.jsx)(h.V,{opened:C,size:"min(90vw, 30rem)",children:(0,c.jsxs)(p.K,{children:[n?(0,c.jsx)(v.z,{onClick:function(){return i(!0)},children:"Show Editor"}):(0,c.jsx)(c.Fragment,{}),(0,c.jsxs)(w.Z,{grow:!0,children:[(0,c.jsxs)(m.v,{shadow:"md",children:[(0,c.jsx)(m.v.Target,{children:(0,c.jsx)(v.z,{children:W?(0,c.jsx)(g.a,{color:"white",size:"sm"}):z?"View ".concat(z.id+1):"Connect View"})}),(0,c.jsx)(m.v.Dropdown,{children:(0,c.jsx)(y.M,{cols:3,children:Array(4).fill(0).map((function(e,n){return 3*n+2})).map((function(e){return(0,c.jsx)(w.Z,{grow:!0,children:(0,c.jsx)(x.A,{size:"xl",onClick:function(){return $(e)},children:e})},e)}))})})]}),(0,c.jsxs)(m.v,{shadow:"md",children:[(0,c.jsx)(m.v.Target,{children:(0,c.jsx)(v.z,{children:q?(0,c.jsx)(g.a,{color:"white",size:"sm"}):A?"Racket ".concat(A.id):"Connect Racket"})}),(0,c.jsx)(m.v.Dropdown,{children:(0,c.jsx)(y.M,{cols:3,children:Array(4).fill(0).map((function(e,n){return 3*n})).map((function(e){return(0,c.jsx)(w.Z,{grow:!0,children:(0,c.jsx)(x.A,{size:"xl",onClick:function(){return Q(e)},children:e})},e)}))})})]})]}),(0,c.jsx)(w.Z,{grow:!0,children:(0,c.jsx)(b.o,{icon:(0,c.jsx)(d.Z,{}),rightSection:(0,c.jsx)(k.u,{label:"paste",children:(0,c.jsx)(x.A,{onClick:function(){return navigator.clipboard.readText().then(K)},children:(0,c.jsx)(f.Z,{})})}),placeholder:T,onChange:function(e){return K(e.target.value)},width:"100%",value:G})})]})}),(0,c.jsx)(S.d,{position:"right",size:"60vw",opened:o,onClose:function(){return i(!1)},children:(0,c.jsx)(l.ZP,{value:j,onChange:function(e){return E(null!==e&&void 0!==e?e:"")},language:"javascript",theme:"vs-dark"})}),(0,c.jsx)("main",{id:"screen"})]})};function G(){return K.apply(this,arguments)}function K(){return(K=(0,t.Z)(s().mark((function e(){var n,r,t,i,c,u,l,d,f,h,p,v,w,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new E.L,r=new j.RSm,e.next=4,Promise.all([n.loadAsync("".concat(V,"/assets/models.obj")),n.loadAsync("".concat(V,"/assets/table.obj"))]);case 4:for(t=e.sent,i=!0,c=!1,u=void 0,e.prev=6,l=t[Symbol.iterator]();!(i=(d=l.next()).done);i=!0)d.value.traverse((function(e){return(0,o.Z)(e,j.Kj0)&&(e.material=r)}));e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),c=!0,u=e.t0;case 14:e.prev=14,e.prev=15,i||null==l.return||l.return();case 17:if(e.prev=17,!c){e.next=20;break}throw u;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return f=(0,a.Z)(t,2),h=f[0],p=f[1],v=h.getObjectByName("ball"),w=h.getObjectByName("racket"),m=h.getObjectByName("head"),e.abrupt("return",{ballMesh:v,racketMesh:w,headMesh:m,tableGroup:p});case 27:case"end":return e.stop()}}),e,null,[[6,10,14,22],[15,,17,21]])})))).apply(this,arguments)}function U(){return U=(0,t.Z)(s().mark((function e(n,r){var t,o,i,c,u,l,d,f,h,p,v,w,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m=function(e){h.render(t,o)},t=new j.xsS,(o=new j.cPb(80,window.innerWidth/window.innerHeight,.1,1e3)).position.set(2,0,0),o.lookAt(0,0,0),e.next=7,G();case 7:if(i=e.sent,i.ballMesh,c=i.tableGroup,u=i.racketMesh,l=i.headMesh,t.add(c),d=new Map,f=function(e){if(e%3==0)return u.clone();if(e%3==1)return l.clone();throw new Error("dont recieve events from observers")},(h=new j.CP7).setSize(window.innerWidth,window.innerHeight),h.setAnimationLoop(m),!(p=document.querySelector('main[id="screen"]'))){e.next=23;break}p.replaceChildren(h.domElement),e.next=24;break;case 23:throw Error("failed to replace screen with renderer.");case 24:v=n.code?new Function("id","playerData","object",n.code):function(e,n,t){e==r.id-1?(o.quaternion.fromArray(n.orientation),o.position.fromArray(n.position)):t?(t.quaternion.fromArray(n.orientation),t.position.fromArray(n.position)):console.error("no mesh provided for body that needs to be drawn with id [".concat(e,"]"))},w=function(e){Object.entries(e).forEach((function(e){var n=(0,a.Z)(e,2),o=n[0],i=n[1],s=parseInt(o);if(!d.has(s)&&r.id!=s){var c=f(s);d.set(s,c),t.add(c),console.log("created mesh for id",s)}v(s,i,d.get(s))}))},r.ws.addEventListener("message",(function(e){var n=e.data;return w(J.asPlayerPose(n))}));case 28:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}}},function(e){e.O(0,[737,164,774,888,179],(function(){return n=8312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);