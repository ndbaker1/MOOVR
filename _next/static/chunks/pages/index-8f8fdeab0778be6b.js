(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(n,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(1472)}])},1472:function(n,e,r){"use strict";r.r(e),r.d(e,{default:function(){return J}});var t=r(7568),o=r(603),i=r(4051),a=r.n(i),s=r(5893),c=r(7294),u=r(9604),l=r(8254),d=r(7707),h=r(6772),p=r(7564),f=r(7841),w=r(6137),v=r(4078),x=r(966),y=r(9814),m=r(9834),g=r(5477),k=r(8393),S=r(9513),j=r(9477),b=r(7011),Z=r(1438),E=r(1799);function A(n){var e=n.path,r=n.host,t=n.closeCallback,o=n.errorCallback,i=n.openCallback,a=location.protocol.includes("https")?"wss":"ws",s="".concat(a,"://").concat(r).concat(e);if(!s.startsWith("ws"))throw Error("bad url");var c=new WebSocket(s);return c.addEventListener("close",(function(n){return t?t(n):console.log(JSON.stringify(n))})),c.addEventListener("error",(function(n){return o?o(n):console.error(JSON.stringify(n))})),c.addEventListener("open",(function(n){return i?i(n):console.log(JSON.stringify(n))})),c}function C(){return(C=(0,t.Z)(a().mark((function n(e){var r,t;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"}),n.next=3,Promise.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"magnetometer"}),navigator.permissions.query({name:"gyroscope"})]);case 3:return t=n.sent,r.addEventListener("reading",(function(){try{e({type:"Rotation",data:r.quaternion})}catch(n){console.error(n),r.stop()}})),r.addEventListener("error",console.log),t.every((function(n){return"granted"===n.state}))?r.start():console.log("No permissions to use AbsoluteOrientationSensor."),n.abrupt("return",(function(){return r.stop()}));case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function z(){return(z=(0,t.Z)(a().mark((function n(e){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=new LinearAccelerationSensor({frequency:60})).addEventListener("reading",(function(){try{e({type:"Acceleration",data:[r.x,r.y,r.z]})}catch(n){console.error(n),r.stop()}})),r.addEventListener("error",console.log),r.start(),n.abrupt("return",(function(){return r.stop()}));case 5:case"end":return n.stop()}}),n)})))).apply(this,arguments)}var O,L,N,q,_=function n(e,r,t){var o=this;if((0,Z.Z)(this,n),this.id=e,!("LinearAccelerationSensor"in window))throw alert("LinearAccelerationSensor not supported");if(!("AbsoluteOrientationSensor"in window))throw alert("AbsoluteOrientationSensor not supported");this.ws=A((0,E.Z)({host:r,path:"/racket/".concat(e)},t));var i=function(n){if(o.ws.readyState===o.ws.CLOSING||o.ws.readyState===o.ws.CLOSED)throw Error("connection closed");o.ws.readyState===o.ws.OPEN&&o.ws.send(JSON.stringify(n))};!function(n){z.apply(this,arguments)}(i),function(n){C.apply(this,arguments)}(i)},M=function(){function n(e,r,t){(0,Z.Z)(this,n),this.id=e,this.ws=A((0,E.Z)({host:r,path:"/observer/".concat(e)},t))}return n.asPlayerData=function(n){if("string"===typeof n)return JSON.parse(n);throw Error("invalid data")},n}(),P=r(3454),D=null!==(N=null===P||void 0===P||null===(O=P.env)||void 0===O?void 0:"phone-pong-production.up.railway.app")&&void 0!==N?N:"localhost:42069",H=null!==(q=null===P||void 0===P||null===(L=P.env)||void 0===L?void 0:"/phone-pong")&&void 0!==q?q:"";var J=function(){var n=(0,o.Z)(c.useState(!1),2),e=n[0],r=n[1],t=(0,o.Z)(c.useState(!1),2),i=t[0],a=t[1],j=(0,o.Z)(c.useState(X),2),b=j[0],Z=j[1];c.useEffect((function(){window.debug=function(){return r(!0)}}),[]);var E=(0,o.Z)(c.useState(),2),A=E[0],C=E[1],z=(0,o.Z)(c.useState(!1),2),O=z[0],L=z[1],N=(0,o.Z)(c.useState(),2),q=N[0],P=N[1],H=(0,o.Z)(c.useState(!1),2),J=H[0],R=H[1],T=function(n){var e=(0,o.Z)(c.useState(""),2),r=e[0],t=e[1],i=(r||n).replaceAll(/.*:\/\/|\/$/gi,"");return{host:r,setHost:t,webSocketHost:i}}(D),F=T.host,Y=T.setHost,G=T.webSocketHost;return(0,s.jsxs)("div",{id:"app",children:[(0,s.jsx)(h.V,{opened:!0,size:"min(90vw, 30rem)",children:(0,s.jsxs)(p.K,{children:[e?(0,s.jsx)(f.z,{onClick:function(){return a(!0)},children:"Show Editor"}):(0,s.jsx)(s.Fragment,{}),(0,s.jsxs)(w.Z,{grow:!0,children:[(0,s.jsxs)(v.v,{shadow:"md",children:[(0,s.jsx)(v.v.Target,{children:(0,s.jsx)(f.z,{children:J?(0,s.jsx)(x.a,{color:"white",size:"sm"}):q?"Observer ".concat(q.id):"Connect Observer"})}),(0,s.jsx)(v.v.Dropdown,{children:(0,s.jsx)(y.M,{cols:3,children:Array(9).fill(0).map((function(n,e){return(0,s.jsx)(w.Z,{grow:!0,children:(0,s.jsx)(m.A,{size:"xl",onClick:function(){R(!0);var n=new M(e,G,{openCallback:function(){P((function(e){return e&&e.ws.close(),function(n,e){W.apply(this,arguments)}({code:b},n),R(!1),n}))}})},children:e})},e)}))})})]}),(0,s.jsxs)(v.v,{shadow:"md",children:[(0,s.jsx)(v.v.Target,{children:(0,s.jsx)(f.z,{children:O?(0,s.jsx)(x.a,{color:"white",size:"sm"}):A?"Racket ".concat(A.id):"Connect Racket"})}),(0,s.jsx)(v.v.Dropdown,{children:(0,s.jsx)(y.M,{cols:3,children:Array(9).fill(0).map((function(n,e){return(0,s.jsx)(w.Z,{grow:!0,children:(0,s.jsx)(m.A,{size:"xl",onClick:function(){L(!0);var n=new _(e,G,{openCallback:function(){var e=function(){C(n),L(!1)};A?(A.ws.addEventListener("close",e),A.ws.close()):e()}})},children:e})},e)}))})})]})]}),(0,s.jsx)(w.Z,{grow:!0,children:(0,s.jsx)(g.o,{icon:(0,s.jsx)(l.Z,{}),rightSection:(0,s.jsx)(k.u,{label:"paste",children:(0,s.jsx)(m.A,{onClick:function(){return navigator.clipboard.readText().then(Y)},children:(0,s.jsx)(d.Z,{})})}),placeholder:D,onChange:function(n){return Y(n.target.value)},width:"100%",value:F})})]})}),(0,s.jsx)(S.d,{position:"right",size:"60vw",opened:i,onClose:function(){return a(!1)},children:(0,s.jsx)(u.ZP,{value:b,onChange:function(n){return Z(null!==n&&void 0!==n?n:"")},language:"javascript",theme:"vs-dark"})}),(0,s.jsx)("main",{id:"screen"})]})};function R(){return T.apply(this,arguments)}function T(){return(T=(0,t.Z)(a().mark((function n(){var e,r,t,o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e=new b.L,n.next=3,e.loadAsync("".concat(H,"/assets/phone-pong.obj"));case 3:return r=n.sent,(t=r.children[1]).material=new j.RSm,(o=r.children[0]).material=new j.RSm,n.abrupt("return",{racketMesh:t,ballMesh:o});case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function W(){return W=(0,t.Z)(a().mark((function n(e,r){var t,i,s,c,u,l,d,h,p,f;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return f=function(n){l.render(t,i)},t=new j.xsS,(i=new j.cPb(80,window.innerWidth/window.innerHeight,.1,1e4)).position.set(-500,0,0),i.lookAt(0,0,0),n.next=7,R();case 7:if(s=n.sent,s.ballMesh,c=s.racketMesh,u=new Map,(l=new j.CP7).setSize(window.innerWidth,window.innerHeight),l.setAnimationLoop(f),!(d=document.querySelector('main[id="screen"]'))){n.next=19;break}d.replaceChildren(l.domElement),n.next=20;break;case 19:throw Error("failed to replace screen with renderer.");case 20:p=new Function("id","playerData","rackets","racketMesh","scene",null!==(h=e.code)&&void 0!==h?h:""),r.ws.addEventListener("message",(function(n){var r=n.data,i=M.asPlayerData(r);Object.entries(i).forEach((function(n){var r=(0,o.Z)(n,2),i=r[0],a=r[1];if(e.code)p(i,a,u,c,t);else{if(!u.has(i)){var s=c.clone();u.set(i,s),t.add(s)}var l=u.get(i),d=(0,o.Z)(a.rotation,4),h=d[0],f=d[1],w=d[2],v=d[3],x=l.quaternion.fromArray([h,w,f,v]).invert();x.z*=-1,x.w*=-1;var y=(0,o.Z)(a.position.map((function(n){return 2e3*n})),3);y[0],y[1],y[2]}}))}));case 24:case"end":return n.stop()}}),n)}))),W.apply(this,arguments)}var X="\n// logic for adding new meshes when a new player connects\nif (!rackets.has(id)) {\n  const racket = racketMesh.clone()\n  rackets.set(id, racket)\n  scene.add(racket)\n}\nconst racket = rackets.get(id)\n\n{\n  const [x, y, z, w] = playerData.rotation\n  // flip y and z based on how we interpret them.\n  const quaternion = racket.quaternion.fromArray([x, z, y, w]).invert()\n  // reverse the X and Y rotation,\n  // which means mirror the XY plane (negation of the Z and W values).\n  quaternion.z *= -1\n  quaternion.w *= -1\n}\n\n{\n  const [x, y, z] = playerData.position.map(i => i * 2000)\n  // racket.position.fromArray([x, y, z])\n  // racket.position.fromArray([x, y, z])\n}\n"}},function(n){n.O(0,[737,13,774,888,179],(function(){return e=8312,n(n.s=e);var e}));var e=n.O();_N_E=e}]);